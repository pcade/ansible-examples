- name: Remove MySQL if installed (clean start)
  apt:
    name: mysql-server
    state: absent
    purge: yes
    autoremove: yes
  when: mysql_root_password is defined

- name: Remove MySQL data directory
  file:
    path: /var/lib/mysql
    state: absent
  when: mysql_root_password is defined

- name: Set MySQL root password pre-installation
  debconf:
    name: mysql-server
    question: mysql-server/root_password
    value: "{{ mysql_root_password }}"
    vtype: password
  when: mysql_root_password is defined

- name: Set MySQL root password confirmation
  debconf:
    name: mysql-server
    question: mysql-server/root_password_again
    value: "{{ mysql_root_password }}"
    vtype: password
  when: mysql_root_password is defined
